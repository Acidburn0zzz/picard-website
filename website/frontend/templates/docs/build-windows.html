{% extends 'docs/base.html' %}
{% set git_doc = "build-windows.html" %}
{% set doc_title = _("Build on Windows") %}
{% block content %}
<div id="docs" class="container">
  <div class="row">
    <div class="col-md-8">
      <p>
        This page is for Microsoft Windows users who want to contribute to the development of 
        <a href="/" title="MusicBrainz Picard">MusicBrainz Picard</a>
        or for other reasons want to be able to run Picard from source code.
        It explains how to install the 3rd party software needed and also 
        the installer for Windows. 
      </p>
      <h1 id="requirements">Requirements</h1>
      <p>
        Picard development (i.e. Github's master branch) is now focused on Picard version 2, 
        which uses Python 3 and PyQt5. 
        However if you need to test something in Picard 1.4, 
        then a separate branch 1.4.x is available to run and this uses Python 2 and PqQt4. 
        Instructions for building each environment are provided below.
      </p>
      
      <h2 id="source">Downloading the source</h2>
      
      <p>
        If you are planning to simply run from source (rather than use the Picard installer / executable), 
        then you can download the current master branch from 
        <a rel="nofollow" href="https://github.com/metabrainz/picard/archive/master.zip">https://github.com/metabrainz/picard/archive/master.zip</a> 
        or the 1.4.x branch from <a rel="nofollow" href="https://github.com/metabrainz/picard/archive/1.4.x.zip">https://github.com/metabrainz/picard/archive/1.4.x.zip</a>.
      </p>

      <p>
        But if you are planning to submit proposed changes to Picard source,
        then you should install <a rel="nofollow" target="_blank" href="https://desktop.github.com/">GitHub Desktop</a> 
        or an alternative Git tool of your choice and use it to create your own local Git clone of Picard.
      </p>

      <h2 id="Picard2">Picard version 2</h2>

      <h3 id="python">Python 3.5 or newer</h3>

      <ul>
        <li><a rel="nofollow" href="http://python.org/download/">http://python.org/download/</a>
        </li>
        <li>Download and install "Python 3 Windows Installer". 
            The latest version is recommended, but if you already have Python 3 installed,
            then the minimum version is 3.5.
        </li>
        <li>Python should add itself to your %PATH% environment variable, 
            but if not add the Python install directory to %PATH%</li>
      </ul>

      <h3 id="pyqt">Python dependencies</h3>
      
      <p>
         You need need the following additional python modules to run Picard from source:
      </p>

      <ul>
        <li>PyQt 5.7.1 or later</li>
        <li>Mutagen 1.37 or later</li>
        <li>discid</li>
      </ul>

      <p>
         The easiest way to install it is to open an Administrator command prompt,navigate to the Picard source directory and type:
      </p>
      <pre>pip3 install -r requirements.txt</pre>

      <p>
         Alternatively to install them individually run:
      </p>
      <ul>
        <li>pip3 install PyQt>=5.7.1</li>
        <li>pip3 install Mutagen>=1.37</li>
        <li>pip3 install discid</li>
      </ul>

      <h2 id="Picard1">Picard version 1.4.x</h2>

      <h3 id="python">Python 2.7.x</h3>

      <ul>
        <li><a rel="nofollow" href="http://python.org/download/">http://python.org/download/</a>
        </li>
        <li>Download and install "Python 2.7.x Windows Installer"</li>
        <li>Add C:\Python27 to&nbsp;%PATH%</li>
      </ul>

      <h3 id="pyqt">PyQt 4.10.x</h3>

      <ul>
        <li> <a rel="nofollow" href="http://www.riverbankcomputing.co.uk/software/pyqt/download">http://www.riverbankcomputing.co.uk/software/pyqt/download</a>
        </li>
        <li>Download and install "PyQt4-4.10.x-gpl-Py2.7-Qt4.8.x-x32.exe"</li>
      </ul>

      <h3 id="libdiscid">libdiscid</h3>

      <ul>
        <li> <a rel="nofollow" href="http://musicbrainz.org/doc/libdiscid">http://musicbrainz.org/doc/libdiscid</a>
        </li>
        <li>Download "libdiscid-0.6.1-win32.zip" and put "discid.dll" in your Windows\System32 folder</li>
      </ul>

      <h3 id="pip">Pip for Windows</h3>

      <ul>
        <li> <a rel="nofollow" href="https://sites.google.com/site/pydatalog/python/pip-for-windows">https://sites.google.com/site/pydatalog/python/pip-for-windows</a>
        </li>
        <li>Download to a location you find again (no installation)
        </li>
        <li>in Pip_Win:
          <ul>
            <li>
              <code>pip install mutagen</code>for Mutagen (1.22 tested)
            </li>
            <li>
              <code>pip install discid</code>for python-discid (1.1.x tested)
            </li>
          </ul>
        </li>
      </ul>

      <h1 id="running_picard_from_sources">Running Picard From Sources</h1>

      <h3 id="chromaprint">Chromaprint</h3>
      
      <p>
        If you want to run the Acoustid Scan function when running Picard from source, then you need to install
        the Chromaprint fpcalc program into your Picard source directory.

      <ul>
        <li>
          Download <a rel="nofollow" href="https://github.com/acoustid/chromaprint/releases/download/v1.4.2/chromaprint-fpcalc-1.4.2-windows-x86_64.zip">the windows zip file</a> 
          from <a rel="nofollow" href="http://acoustid.org/chromaprint">http://acoustid.org/chromaprint</a>
        </li>
        <li>
          Unzip "chromaprint-fpcalc-1.1-win-i86.zip" and put "fpcalc.exe" to the picard subdirectory 
          of your Picard source code directory
        </li>
      </ul>

      <h3 id="gettext">gettext</h3>
      
      <p> 
        Picard uses gettext for internationalisation (i.e. for Picard to appear in your local language). 
        To build the language mappings you need to install gettext.
      </p> 

      <ul>
        <li>
          Download and install <a rel="nofollow" href="https://downloads.sourceforge.net/project/gnuwin32/gettext/0.14.4/gettext-0.14.4.exe">gettext</a> 
          from <a rel="nofollow" target="_blank" href="http://gnuwin32.sourceforge.net/packages/gettext.htm">http://gnuwin32.sourceforge.net/packages/gettext.htm</a>.
        </li>
        <li>
          Add the gettext folder to&nbsp;%PATH% (default <i>C:\Program Files\GnuWin32\bin</i> or <i>C:\Program Files(x86)\GnuWin32\bin</i>)
        </li>
        <li>
          From the Picard source directory run
          <pre>py setup.py build_locales -i</pre>
        </li>
      </ul>

      <p>
        After you have done this, you can run Picard directly from the sources using:
      </p>

      <pre>
        py tagger.py
      </pre>

      <h3 id="visual-cpp">Visual C++ 2008 Express</h3>

      <ul>
        <li> <a rel="nofollow" href="http://go.microsoft.com/?linkid=7729279">http://go.microsoft.com/?linkid=7729279</a>
        </li>
        <li>Download and install "vcsetup.exe"
        </li>
      </ul>

      <h3 id="chromaprint">Chromaprint</h3>

      <ul>
        <li> <a rel="nofollow" href="http://acoustid.org/chromaprint">http://acoustid.org/chromaprint</a>
        </li>
        <li>Download "chromaprint-fpcalc-1.1-win-i86.zip" and put "fpcalc.exe" to the Picard source code
          directory
        </li>
      </ul>

      <h1 id="running_picard_from_sources">Running Picard From Sources</h1>

      <p>
        Before you can run Picard from sources, you need to build the C extension. Start the VS console using
        "Visual Studio 2008 Command Prompt", go to the source directory and run these commands:
      </p>

      <pre>
        python setup.py build_ext -i
        python setup.py build_locales -i</pre>

      <p>
        After you have done this, you can run Picard directly from the sources using:
      </p>

      <pre>
        python tagger.py</pre>

      <h1 id="building_the_installer">Building the Installer</h1>

      <p>
        To build the installer executable you need additional Tools:
      </p>

      <h3 id="py2exe">py2exe 0.6.9</h3>

      <ul>
        <li> <a rel="nofollow" href="http://sourceforge.net/projects/py2exe/files/py2exe/0.6.9/">http://sourceforge.net/projects/py2exe/files/py2exe/0.6.9/</a>
        </li>
        <li>Download and install "py2exe-0.6.9.win32-py2.7.exe"
        </li>
      </ul>

      <h3 id="nsis">NSIS 2.46</h3>

      <ul>
        <li> <a rel="nofollow" href="http://nsis.sourceforge.net/Download">http://nsis.sourceforge.net/Download</a>
        </li>
        <li>Download and install "nsis-2.46-setup.exe"
        </li>
      </ul>

      <h3 id="visual-cpp">Visual C++ 2015 Community</h3>
      
      Picard will run from source using a python version of the Levenshtein Distance fuzzy string comparison, 
      however to build the C version for inclusion in the executable package, you will need to down  

      <ul>
        <li>Download the <a rel="nofollow" href="http://landinghub.visualstudio.com/visual-cpp-build-tools">Microsoft Visual C++ 14.0 
            standalone: Visual C++ Build Tools 2015 (x86, x64, ARM)</a> from http://landinghub.visualstudio.com/visual-cpp-build-tools</li>
        <li>Install including both 
        </li>
      </ul>

      <p>
        Before you can run Picard from sources, you need to build the C extension. Start the VS console using
        "Visual Studio 2008 Command Prompt", go to the source directory and run these commands:
      </p>

      <pre>
        python setup.py build_ext -i
        python setup.py build_locales -i</pre>

      <p>
        Then you need to copy msvcr90.dll and msvcp90.dll from "C:\Program Files\Microsoft Visual Studio 9.0\VC\redist\x86\Microsoft.VC90.CRT"
        to the source code directory, so that py2exe can find them. You also need copy discid.dll (libdiscid)
        to the picard source.
      </p>
      <p>
        Then you can build the installer using this command:
      </p>
      <pre>
        python setup.py bdist_nsis</pre>

      <p>
        The setup is installer\picard-setup-1.x.exe and an executable for your system is dist\picard.exe, which
        you can use to create a desktop shortcut.
      </p>

      <h1 id="known_issues">Known Issues</h1>
      <p>
        It is possible that the resulting picard.exe does not show the proper file icon. This is probably a bug
        of py2exe on Vista. You can fix the icon with the tool
        <a rel="nofollow" href="http://angusj.com/resourcehacker/">Resource Hacker</a> or any other tool, that
        can edit the resources in executables.
      </p>

    </div>

    <div class="col-md-4">
      <div id="sidebar" class="hidden-xs">
        <ul class="nav" data-spy="affix" data-offset-top="200">
          <li class="active">
            <a href="#requirements">Requirements</a>
            <ul class="nav">
              <li><a href="#python">Python 2.7.x</a></li>
              <li><a href="#pyqt">PyQt 4.10.x</a></li>
              <li><a href="#libdiscid">libdiscid</a></li>
              <li><a href="#pip">Pip for Windows</a></li>
              <li><a href="#gettext">gettext</a></li>
              <li><a href="#visual-cpp">Visual C++ 2008 Express</a></li>
              <li><a href="#chromaprint">Chromaprint</a></li>
            </ul>
          </li>
          <li><a href="#running_picard_from_sources">Running Picard From Sources</a></li>
          <li>
            <a href="#building_the_installer">Building the Installer</a>
            <ul class="nav">
              <li><a href="#py2exe">py2exe 0.6.9</a></li>
              <li><a href="#nsis">NSIS 2.46</a></li>
            </ul>
          </li>
          <li><a href="#known_issues">Known Issues</a></li>
        </ul>
        <!-- <a class="back-to-top" href="#top"> Back to top </a> -->
      </div>
    </div>
  </div>
{% endblock %}
</div>
